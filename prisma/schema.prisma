generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminUser {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  name         String
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([email])
}

enum OrderType {
  DINE_IN
  TAKEAWAY
}

enum OrderStatus {
  PLACED
  ACCEPTED
  IN_KITCHEN
  READY
  COMPLETED
  CANCELLED
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  NO_SHOW
  COMPLETED
}

enum PaymentProvider {
  MIDTRANS
  CASH
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  EXPIRED
  REFUNDED
}

model Category {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items MenuItem[]
}

model MenuItem {
  id          String   @id @default(cuid())
  categoryId  String?
  name        String
  description String?
  price       Int
  photoUrl    String?
  isAvailable Boolean  @default(true)
  isFeatured  Boolean  @default(false)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  category   Category?   @relation(fields: [categoryId], references: [id])
  orderItems OrderItem[]

  @@index([categoryId])
  @@index([isFeatured])
}

model Table {
  id        String   @id @default(cuid())
  tableCode String   @unique
  name      String?
  capacity  Int
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  reservations Reservation[]
  orders       Order[]
}

model Reservation {
  id            String            @id @default(cuid())
  tableId       String?
  customerName  String
  customerPhone String
  partySize     Int
  startAt       DateTime
  notes         String?
  status        ReservationStatus @default(PENDING)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  table  Table?  @relation(fields: [tableId], references: [id])
  orders Order[]

  @@index([tableId])
  @@index([status])
  @@index([startAt])
}

model Order {
  id          String      @id @default(cuid())
  orderNumber String      @unique
  type        OrderType
  status      OrderStatus @default(PLACED)

  tableId       String?
  reservationId String?

  customerName  String?
  customerPhone String?
  notes         String?

  subtotal Int @default(0)
  total    Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  table       Table?       @relation(fields: [tableId], references: [id])
  reservation Reservation? @relation(fields: [reservationId], references: [id])
  items       OrderItem[]
  payments    Payment[]

  @@index([tableId])
  @@index([reservationId])
  @@index([status])
  @@index([type])
}

model OrderItem {
  id         String @id @default(cuid())
  orderId    String
  menuItemId String

  nameSnapshot  String
  priceSnapshot Int
  qty           Int
  notes         String?
  lineTotal     Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  order    Order    @relation(fields: [orderId], references: [id])
  menuItem MenuItem @relation(fields: [menuItemId], references: [id])

  @@index([orderId])
  @@index([menuItemId])
}

model Payment {
  id       String          @id @default(cuid())
  orderId  String
  provider PaymentProvider @default(MIDTRANS)
  amount   Int
  currency String          @default("IDR")
  status   PaymentStatus   @default(PENDING)

  providerRef     String?
  providerPayload Json?
  paidAt          DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  order Order @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@index([status])
}

model Review {
  id          String   @id @default(cuid())
  authorName  String
  rating      Int
  comment     String?
  isPublished Boolean  @default(false)
  isFeatured  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isPublished])
  @@index([isFeatured])
  @@index([rating])
}

model LandingHero {
  id          String   @id @default(cuid())
  title       String
  subtitle    String
  description String
  ctaText     String
  ctaLink     String
  promoText   String?
  imageUrl    String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// DEPRECATED: Use MenuItem.isFeatured instead
model FeaturedMenuItem {
  id          String   @id @default(cuid())
  menuItemId  String?
  name        String
  description String
  price       Int
  imageUrl    String
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model RestaurantInfo {
  id             String   @id @default(cuid())
  name           String
  description    String
  address        String
  phoneNumber    String
  email          String
  mapsUrl        String?
  mapsEmbedUrl   String?
  openingHours   String
  updatedAt      DateTime @updatedAt
}

model SiteSettings {
  id        String   @id @default(cuid())
  key       String   @unique // 'header' or 'footer'
  
  // Header settings
  logoUrl   String?
  logoText  String?
  
  // Social media links
  facebookUrl  String?
  instagramUrl String?
  twitterUrl   String?
  
  // Footer settings
  copyrightText String?
  footerLinks   Json?   // JSON array of {label, url}
  
  updatedAt DateTime @updatedAt
  
  @@index([key])
}
